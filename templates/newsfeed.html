{% extends "base.html" %}
{% block content %}
<h1> News Feed for {{username}}</h1>

<div id = "uk-grid">
  {% for post in posts %}
  <div class = "uk-width-auto@m"></div>
  <div class = "uk-width-auto@m">
    <div class="uk-card uk-card-small uk-card-default">
      <div class="uk-card-body uk-card-small uk-align-center">
        <h3><a href={{url_for("profile", username = post['username'])}}>{{post['username']}}</a></h3>
        <h4>{{post['location']}}</h4>
      </div>
      <div class="uk-card-media-bottom uk-align-center ">
        <div class="uk-grid-small uk-flex-middle" uk-grid>
          <p><img width="500" height="500" src="{{url_for('pic',fname=post['pic'])}}" alt="{{post['pic']}}"></p>
        </div>
      </div>
      <div class="uk-card-footer uk-card-small uk-card-default uk-align-center" id = "footer">
        <form  post_id = {{post['post_id']}} action="" method="POST" id="likeform">
          <input class="uk-button uk-button-default" id="likeButton" value = "like" name="likeButton" type = "button"></input>
        </form>
        <h3 class = 'likes' likes = {{post['likes']}}>{{post['likes']}} likes</h3>
      </div>
    </div>
  </div>
  <div class = "uk-width-auto@m"></div>
  {% endfor %}
 </div>

  <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
  <script>
    console.log("JAVASCRIPT");
    var url_for_likePostAjax = "/likePostAjax/";
    $("#uk-grid").on("click", '[name=likeButton]',function (event) {

        //retrieving the different values necessary to update likes
        var $post = $(event.target);
        var likes = $post.closest(".uk-card-footer").find(".likes");

        var post_id = $post.closest("[post_id]").attr('post_id');
        //posts the average rating value returend by setRatingAjax route in app.py
        $.post('/likePostAjax/', {"post_id":post_id},
          function showLikes(dict) {
            likes.text(dict.likes + " likes");
          },
          "json");

      });


    </script>

  {% endblock %}
